{% extends "base.html" %}

{% block title %}Secret Bewerken - Secret Manager{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Secret Bewerken</h1>
        <a href="{{ url_for('secrets.list') }}" class="btn btn-outline">‚Üê Terug naar lijst</a>
    </div>

    <div class="form-container">
        <form method="POST" class="secret-form">
            <div class="form-group">
                <label for="name" class="required">Naam</label>
                <input type="text" 
                       id="name" 
                       name="name" 
                       required 
                       placeholder="Bijv. Gmail wachtwoord, API sleutel, etc."
                       value="{{ request.form.name if request.form.name else secret.name }}">
                <small class="form-help">Geef je secret een herkenbare naam</small>
            </div>

            <div class="form-group">
                <label for="category">Categorie</label>
                <select id="category" name="category">
                    <option value="">Selecteer categorie (optioneel)</option>
                    {% set current_category = request.form.category if request.form.category else secret.category %}
                    <option value="Wachtwoord" {{ 'selected' if current_category == 'Wachtwoord' }}>Wachtwoord</option>
                    <option value="API Sleutel" {{ 'selected' if current_category == 'API Sleutel' }}>API Sleutel</option>
                    <option value="Database" {{ 'selected' if current_category == 'Database' }}>Database</option>
                    <option value="SSH Sleutel" {{ 'selected' if current_category == 'SSH Sleutel' }}>SSH Sleutel</option>
                    <option value="Token" {{ 'selected' if current_category == 'Token' }}>Token</option>
                    <option value="Certificaat" {{ 'selected' if current_category == 'Certificaat' }}>Certificaat</option>
                    <option value="Overig" {{ 'selected' if current_category == 'Overig' }}>Overig</option>
                </select>
            </div>

            <div class="form-group">
                <label for="description">Beschrijving</label>
                <textarea id="description" 
                          name="description" 
                          rows="3" 
                          placeholder="Optionele beschrijving van deze secret">{{ request.form.description if request.form.description else secret.description }}</textarea>
            </div>

            <div class="form-group">
                <label for="secret_value" class="required">Secret Waarde</label>
                <textarea id="secret_value" 
                          name="secret_value" 
                          required 
                          rows="4" 
                          placeholder="Voer hier je gevoelige informatie in">{{ request.form.secret_value if request.form.secret_value else secret.secret_value }}</textarea>
                <small class="form-help">Dit is de daadwerkelijke geheime informatie</small>
                {% if secret.encrypted == 'True' %}
                    <div class="encryption-notice">
                        üîí Deze secret was ge√´ncrypteerd. De waarde hierboven is gedecodeerd voor bewerking.
                    </div>
                {% endif %}
            </div>

            <!-- Encryption Section -->
            <div class="encryption-section">
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" 
                               id="use_encryption" 
                               name="use_encryption" 
                               onchange="toggleEncryption()"
                               {{ 'checked' if request.form.use_encryption or secret.encrypted == 'True' }}>
                        <span class="checkmark"></span>
                        Encryptie gebruiken voor extra beveiliging
                    </label>
                </div>

                <div id="encryption-password" class="form-group" style="display: none;">
                    <label for="password">Encryptie Wachtwoord</label>
                    <input type="password" 
                           id="password" 
                           name="password" 
                           placeholder="Voer een sterk wachtwoord in voor encryptie">
                    <small class="form-help">
                        <strong>Belangrijk:</strong> Onthoud dit wachtwoord goed! 
                        Zonder dit wachtwoord kun je je secret niet meer lezen.
                        {% if secret.encrypted == 'True' %}
                        <br><em>Laat leeg om de huidige encryptie te behouden.</em>
                        {% endif %}
                    </small>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Wijzigingen Opslaan</button>
                <a href="{{ url_for('secrets.list') }}" class="btn btn-outline">Annuleren</a>
            </div>
        </form>
    </div>

    <!-- Secret Info -->
    <div class="secret-info">
        <h3>üìã Secret Informatie</h3>
        <div class="info-grid">
            <div class="info-item">
                <strong>ID:</strong> {{ secret.id }}
            </div>
            <div class="info-item">
                <strong>Aangemaakt:</strong> {{ secret.created_at if secret.created_at else 'Onbekend' }}
            </div>
            <div class="info-item">
                <strong>Laatst bijgewerkt:</strong> {{ secret.updated_at if secret.updated_at else 'Nooit' }}
            </div>
            <div class="info-item">
                <strong>Encryptie status:</strong> 
                {% if secret.encrypted == 'True' %}
                    <span class="status-encrypted">üîí Ge√´ncrypteerd</span>
                {% else %}
                    <span class="status-plain">üìù Platte tekst</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Help Section -->
    <div class="help-section">
        <h3>üí° Tips voor het bewerken van secrets</h3>
        <ul>
            <li><strong>Voorzichtig bewerken:</strong> Controleer je wijzigingen voordat je opslaat</li>
            <li><strong>Encryptie wijzigen:</strong> Je kunt encryptie aan- of uitzetten bij het bewerken</li>
            <li><strong>Backup:</strong> Zorg dat je belangrijke secrets elders hebt opgeslagen</li>
            <li><strong>Wachtwoord vergeten:</strong> Als je het encryptie wachtwoord vergeet, is de data verloren</li>
        </ul>
    </div>
</div>

<script>
function toggleEncryption() {
    const checkbox = document.getElementById('use_encryption');
    const passwordField = document.getElementById('encryption-password');
    
    if (checkbox.checked) {
        passwordField.style.display = 'block';
        // Don't make password required for editing - user might want to keep existing encryption
    } else {
        passwordField.style.display = 'none';
        document.getElementById('password').value = '';
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleEncryption();
});
</script>
{% endblock %}