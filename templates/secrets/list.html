{% extends "base.html" %}

{% block title %}Mijn Secrets - Secret Manager{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Mijn Secrets</h1>
        <a href="{{ url_for('secrets.add') }}" class="btn btn-primary">Nieuwe Secret Toevoegen</a>
    </div>

    <!-- Filter Section -->
    <div class="filter-section">
        <form method="GET" class="filter-form">
            <div class="filter-group">
                <input type="text" 
                       name="filter" 
                       value="{{ filter_term }}" 
                       placeholder="Zoek op naam, beschrijving of categorie..."
                       class="filter-input">
                <button type="submit" class="btn btn-outline">Filteren</button>
                {% if filter_term %}
                    <a href="{{ url_for('secrets.list') }}" class="btn btn-outline">Reset</a>
                {% endif %}
            </div>
        </form>
    </div>

    <!-- Encryption Password Section -->
    {% if not session.encryption_password %}
    <div class="encryption-section">
        <form method="POST" action="{{ url_for('secrets.set_password') }}" class="password-form">
            <div class="form-group">
                <label for="password">Wachtwoord voor geëncrypteerde secrets:</label>
                <input type="password" id="password" name="password" placeholder="Voer je wachtwoord in">
                <button type="submit" class="btn btn-secondary">Instellen</button>
            </div>
        </form>
    </div>
    {% endif %}

    <!-- Results Info -->
    <div class="results-info">
        {% if filter_term %}
            <p>{{ total_secrets }} resultaten gevonden voor "{{ filter_term }}"</p>
        {% else %}
            <p>Totaal {{ total_secrets }} secrets</p>
        {% endif %}
    </div>

    <!-- Secrets Table -->
    {% if secrets %}
    <div class="secrets-table-container">
        <table class="secrets-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Naam</th>
                    <th>Categorie</th>
                    <th>Beschrijving</th>
                    <th>Secret Waarde</th>
                    <th>Aangemaakt</th>
                    <th>Acties</th>
                </tr>
            </thead>
            <tbody>
                {% for secret in secrets %}
                <tr>
                    <td>{{ loop.index + (current_page - 1) * 10 }}</td>
                    <td class="secret-name">{{ secret.name }}</td>
                    <td class="secret-category">
                        {% if secret.category %}
                            <span class="category-tag">{{ secret.category }}</span>
                        {% else %}
                            <span class="category-tag category-none">Geen</span>
                        {% endif %}
                    </td>
                    <td class="secret-description">{{ secret.description or '-' }}</td>
                    <td class="secret-value">
                        <div class="secret-value-container">
                            <span class="secret-hidden" id="secret-{{ secret.id }}">••••••••</span>
                            <span class="secret-revealed" id="revealed-{{ secret.id }}" style="display: none;">
                                {{ secret.secret_value }}
                                {% if secret.encrypted == 'True' %}
                                    <span class="encrypted-badge">🔒</span>
                                {% endif %}
                            </span>
                            <button type="button" 
                                    class="btn-toggle-secret" 
                                    onclick="toggleSecret('{{ secret.id }}')">
                                👁️
                            </button>
                        </div>
                    </td>
                    <td class="secret-date">{{ secret.created_at[:10] if secret.created_at else '-' }}</td>
                    <td class="secret-actions">
                        <a href="{{ url_for('secrets.edit', secret_id=secret.id) }}" 
                           class="btn btn-sm btn-outline" 
                           title="Bewerken">✏️</a>
                        <form method="POST" 
                              action="{{ url_for('secrets.delete', secret_id=secret.id) }}" 
                              style="display: inline;"
                              onsubmit="return confirm('Weet je zeker dat je deze secret wilt verwijderen?')">
                            <button type="submit" 
                                    class="btn btn-sm btn-danger" 
                                    title="Verwijderen">🗑️</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="pagination">
        {% if has_prev %}
            <a href="{{ url_for('secrets.list', page=prev_page, filter=filter_term) }}" 
               class="btn btn-outline">← Vorige</a>
        {% endif %}
        
        <span class="pagination-info">
            Pagina {{ current_page }} van {{ total_pages }}
        </span>
        
        {% if has_next %}
            <a href="{{ url_for('secrets.list', page=next_page, filter=filter_term) }}" 
               class="btn btn-outline">Volgende →</a>
        {% endif %}
    </div>
    {% endif %}

    {% else %}
    <div class="empty-state">
        <div class="empty-icon">📝</div>
        <h3>Geen secrets gevonden</h3>
        {% if filter_term %}
            <p>Er zijn geen secrets die overeenkomen met je zoekopdracht "{{ filter_term }}".</p>
            <a href="{{ url_for('secrets.list') }}" class="btn btn-outline">Alle secrets bekijken</a>
        {% else %}
            <p>Je hebt nog geen secrets toegevoegd. Voeg je eerste secret toe om te beginnen.</p>
            <a href="{{ url_for('secrets.add') }}" class="btn btn-primary">Eerste Secret Toevoegen</a>
        {% endif %}
    </div>
    {% endif %}
</div>

<script>
function toggleSecret(secretId) {
    const hiddenElement = document.getElementById('secret-' + secretId);
    const revealedElement = document.getElementById('revealed-' + secretId);
    
    if (hiddenElement.style.display === 'none') {
        hiddenElement.style.display = 'inline';
        revealedElement.style.display = 'none';
    } else {
        hiddenElement.style.display = 'none';
        revealedElement.style.display = 'inline';
    }
}
</script>
{% endblock %}